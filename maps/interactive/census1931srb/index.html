<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kraljevina Jugoslavija | Podaci prema popisu iz 1931.</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <link href="map.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css"
    />
    <!-- <script
      src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"
      type="text/javascript"
    ></script> -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"></script>
    <link
      rel="stylesheet"
      href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.0.1/spin.min.js"
      type="text/javascript"
    ></script>
    <script src="https://d3js.org/d3.v4.min.js" type="text/javascript"></script>
    <script
      src="https://d3js.org/d3-scale-chromatic.v1.min.js"
      type="text/javascript"
    ></script>
    <script
      src="https://unpkg.com/topojson-client@3"
      type="text/javascript"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.11.0/d3-legend.js"
      type="text/javascript"
    ></script>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-12">
          <div id="title" class="page-header">
            <h2>Kraljevina Jugoslavija</h2>
            <h4>Prema popisu iz 1931. na nivou srezova i gradova</h4>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 col-lg-4 searchContainer">
          <div class="category">
            <label for="dimensions" class="col-form-label">
              ODABERITE KATEGORIJU
            </label>
            <select class="form-control" id="dimensions"></select>
          </div>
          <div class="search">
            <div id="county_search_container">
              <label for="county_search_box" class="col-form-label"
                >PRETRAŽITE I ODABERITE SREZ ILI GRAD</label
              >
              <input
                id="county_search_box"
                type="text"
                class="form-control"
                placeholder="Upišite naziv sreza (npr. Azbukovica)"
                aria-describedby="sizing-addon2"
              />
            </div>
          </div>
        </div>
      </div>
      <div class="row" id="canvas">
        <div class="col-lg-9 col-xs-12 svg">
          <div class="scaling-svg-container">
            <svg></svg>
          </div>
        </div>
        <div class="col-lg-3 col-md-12 textContainer">
          <div id="textDescription">
            <h3></h3>
            <p></p>
          </div>
          <div id="source"></div>
          <div class="authors">
            <h3>Mapu stvorili</h3>
            <a target="_blank" rel="noopener" href="https://milosp.info"
              >Miloš Popović</a
            >
            i
            <a
              target="_blank"
              rel="noopener"
              href="https://aleksandarpopovic.com/"
              >Aleksandar Popović</a
            >
          </div>
        </div>
      </div>
    </div>

    <script defer type="text/javascript">
      // default view for map
      let measure = "illiteracy";

      const cols = {
        illiteracy: {
          label: "Nepismeni, ukupno (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismeni, ukupno",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Ljudi stariji od 10 koji ne umeju da čitaju i pišu su svrstani u nepismene. Ovde je prikazan udeo nepismenih u populaciji starijoj od 10.",
        },

        illiteracy11_19: {
          label: "Nepismeni, uzrasta 11-19 (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismeni, uzrasta 11-19",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Ljudi uzrasta od 11 do 19 koji ne umeju da čitaju i pišu su svrstani u nepismene. Ovde je prikazan udeo nepismenih u populaciji uzrasta od 11 do 19.",
        },

        illiteracy20_39: {
          label: "Nepismeni, uzrasta 20-39 (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismeni, uzrasta 20-39",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Ljudi uzrasta od 20 do 39 koji ne umeju da čitaju i pišu su svrstani u nepismene. Ovde je prikazan udeo nepismenih u populaciji uzrasta od 20 do 39.",
        },

        illiteracy40_59: {
          label: "Nepismeni, uzrasta 40-59 (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismeni, uzrasta 40-59",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Ljudi uzrasta od 40 do 59 koji ne umeju da čitaju i pišu su svrstani u nepismene. Ovde je prikazan udeo nepismenih u populaciji uzrasta od 40 do 59.",
        },

        illiteracy_60: {
          label: "Nepismeni, 60 godina i naviše (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismeni, 60 godina i naviše",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Ljudi starosti 60 godina i naviše koji ne umeju da čitaju i pišu su svrstani u nepismene. Ovde je prikazan udeo nepismenih u populaciji starosti 60 godina i naviše.",
        },

        illiteracy_f: {
          label: "Nepismene žene, ukupno (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismene žene, ukupno",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Žene starije od 10 koje ne umeju da čitaju i pišu su svrstane u nepismene. Ovde je prikazan udeo nepismenih žena u ženskoj populaciji starijoj od 10.",
        },

        illiteracy_m: {
          label: "Nepismeni muškarci, ukupno (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismeni muškarci, ukupno",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Muškarci stariji od 10 koji ne umeju da čitaju i pišu su svrstani u nepismene. Ovde je prikazan udeo nepismenih muškaraca u muškoj populaciji starijoj od 10.",
        },

        illiteracy_f_11_19: {
          label: "Nepismene žene, uzrasta 11-19 (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismene žene, uzrasta 11-19",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Žene uzrasta od 11 do 19 koje ne umeju da čitaju i pišu su svrstane u nepismene. Ovde je prikazan udeo nepismenih žena u ženskoj populaciji uzrasta od 11 do 19.",
        },

        illiteracy_m_11_19: {
          label: "Nepismeni muškarci, uzrasta 11-19 (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismeni muškarci, uzrasta 11-19",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Muškarci uzrasta od 11 do 19 koji ne umeju da čitaju i pišu su svrstani u nepismene. Ovde je prikazan udeo nepismenih muškaraca u muškoj populaciji uzrasta od 11 do 19.",
        },

        illiteracy_f_21_39: {
          label: "Nepismene žene, uzrasta 20-39 (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismene žene, uzrasta 20-39",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Žene uzrasta od 20 do 39 koje ne umeju da čitaju i pišu su svrstane u nepismene. Ovde je prikazan udeo nepismenih žena u ženskoj populaciji uzrasta od 20 do 39.",
        },

        illiteracy_m_21_39: {
          label: "Nepismeni muškarci, uzrasta 20-39 (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismeni muškarci, uzrasta 20-39",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Muškarci uzrasta od 20 do 39 koji ne umeju da čitaju i pišu su svrstani u nepismene. Ovde je prikazan udeo nepismenih muškaraca u muškoj populaciji uzrasta od 20 do 39.",
        },

        illiteracy_f_40_59: {
          label: "Nepismene žene, uzrasta 40-59 (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismene žene, uzrasta 40-59",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Žene uzrasta od 40 do 59 koje ne umeju da čitaju i pišu su svrstane u nepismene. Ovde je prikazan udeo nepismenih žena u ženskoj populaciji uzrasta od 40 do 59.",
        },

        illiteracy_m_40_59: {
          label: "Nepismeni muškarci, uzrasta 40-59 (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismeni muškarci, uzrasta 40-59",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Muškarci uzrasta od 40 do 59 koji ne umeju da čitaju i pišu su svrstani u nepismene. Ovde je prikazan udeo nepismenih muškaraca u muškoj populaciji uzrasta od 40 do 59.",
        },

        illiteracy_f_60: {
          label: "Nepismene žene, 60 godina i naviše (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismene žene, 60 godina i naviše",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Žene starosti 60 godina i naviše koje ne umeju da čitaju i pišu su svrstane u nepismene. Ovde je prikazan udeo nepismenih žena u ženskoj populaciji starosti 60 godina i naviše.",
        },

        illiteracy_m_60: {
          label: "Nepismeni muškarci, 60 godina i naviše (u %)",
          type: "number",
          format: ".1%",
          title: "Nepismeni muškarci, 60 godina i naviše",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Muškarci starosti 60 godina i naviše koji ne umeju da čitaju i pišu su svrstani u nepismene. Ovde je prikazan udeo nepismenih muškaraca u muškoj populaciji starosti 60 godina i naviše.",
        },

        orthodox: {
          label: "Pravoslavni hrišćani (u %)",
          type: "number",
          format: ".1%",
          title: "Pravoslavni hrišćani",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Procenat osoba koje se izjašnjavaju kao pravoslavni vernici.",
        },

        protestant: {
          label: "Protestanti (u %)",
          type: "number",
          format: ".1%",
          title: "Protestanti",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description:
            "Procenat osoba koje se izjašnjavaju kao evangelisti (protestanti).",
        },

        rcatholic: {
          label: "Rimokatolici (u %)",
          type: "number",
          format: ".1%",
          title: "Rimokatolici",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat osoba koje se izjašnjavaju kao rimokatolički vernici.",
        },

        muslim: {
          label: "Muslimani (u %)",
          type: "number",
          format: ".1%",
          title: "Muslimani",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat osoba koje se izjašnjavaju kao muslimani.",
        },

        otherrel: {
          label: "Druga vera (u %)",
          type: "number",
          format: ".1%",
          title: "Druga vera",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat osoba koje se izjašnjavaju kao pripadnici druge vere.",
        },

        s_lang_srb_cro_svn: {
          label: "Jezik, srpski/hrvatski/slovenački (u %)",
          type: "number",
          format: ".1%",
          title: "Jezik, srpski/hrvatski/slovenački",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat osoba čiji je maternji jezik srpski, hrvatski ili slovenački.",
        },

        s_lang_othr_slavic: {
          label: "Jezik, drugi slovenski (u %)",
          type: "number",
          format: ".1%",
          title: "Jezik, drugi slovenski",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat osoba čiji je maternji jezik neki drugi slovenski jezik.",
        },

        s_lang_hungarian: {
          label: "Jezik, mađarski (u %)",
          type: "number",
          format: ".1%",
          title: "Jezik, mađarski",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat osoba čiji je maternji jezik mađarski.",
        },

        s_lang_german: {
          label: "Jezik, nemački (u %)",
          type: "number",
          format: ".1%",
          title: "Jezik, nemački",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat osoba čiji je maternji jezik nemački.",
        },

        s_lang_albanian: {
          label: "Jezik, albanski(u %)",
          type: "number",
          format: ".1%",
          title: "Jezik, albanski",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat osoba čiji je maternji jezik albanski.",
        },

         s_lang_other: {
          label: "Jezik, drugi (u %)",
          type: "number",
          format: ".1%",
          title: "Jezik, drugi",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat osoba čiji je maternji jezik neki drugi, nenavedeni jezik.",
        },

        t_employed_agriculture_perc: {
          label: "Ukupna zaposlenost, poljoprivreda (u %)",
          type: "number",
          format: ".1%",
          title: "Ukupna zaposlenost, poljoprivreda",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog stanovništva koje radi u poljoprivredi, ribarstvu ili šumarstvu.",
        },

            t_employed_agriculture_men_perc: {
          label: "Zaposlenost muškaraca, poljoprivreda (u %)",
          type: "number",
          format: ".1%",
          title: "Zaposlenost muškaraca, poljoprivreda",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog muškog stanovništva koje radi u poljoprivredi, ribarstvu ili šumarstvu.",
        },

              t_employed_agriculture_women_perc: {
          label: "Zaposlenost žena, poljoprivreda (u %)",
          type: "number",
          format: ".1%",
          title: "Zaposlenost žena, poljoprivreda",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog ženskog stanovništva koje radi u poljoprivredi, ribarstvu ili šumarstvu.",
        },

        t_employed_industry_perc: {
          label: "Ukupna zaposlenost, industrija (u %)",
          type: "number",
          format: ".1%",
          title: "Ukupna zaposlenost, industrija",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog stanovništva koje je zaposleno u industriji ili se bavi zanatstvom.",
        },

        t_employed_industry_men_perc: {
          label: "Zaposlenost muškaraca, industrija (u %)",
          type: "number",
          format: ".1%",
          title: "Zaposlenost muškaraca, industrija",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog muškog stanovništva koje je zaposleno u industriji ili se bavi zanatstvom.",
        },

        t_employed_industry_women_perc: {
          label: "Zaposlenost žena, industrija (u %)",
          type: "number",
          format: ".1%",
          title: "Zaposlenost žena, industrija",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog ženskog stanovništva koje je zaposleno u industriji ili se bavi zanatstvom.",
        },

          t_employed_commerce_perc: {
          label: "Ukupna zaposlenost, trgovina (u %)",
          type: "number",
          format: ".1%",
          title: "Ukupna zaposlenost, trgovina",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog stanovništva koje radi u trgovini, bankarstvu ili saobraćaju.",
        },

        t_employed_commerce_men_perc: {
          label: "Zaposlenost muškaraca, trgovina (u %)",
          type: "number",
          format: ".1%",
          title: "Zaposlenost muškaraca, trgovina",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog muškog stanovništva koje radi u trgovini, bankarstvu ili saobraćaju.",
        },

        t_employed_commerce_women_perc: {
          label: "Zaposlenost žena, trgovina (u %)",
          type: "number",
          format: ".1%",
          title: "Zaposlenost žena, trgovina",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog ženskog stanovništva koje radi u trgovini, bankarstvu ili saobraćaju.",
        },

        t_employed_public_service_perc: {
          label: "Ukupna zaposlenost, javna služba (u %)",
          type: "number",
          format: ".1%",
          title: "Ukupna zaposlenost, javna služba",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog stanovništva koje radi u javnoj službi, vojsci ili ima slobodno zanimanje (npr. advokati ili lekari).",
        },

        t_employed_public_service_men_perc: {
          label: "Zaposlenost muškaraca, javna služba (u %)",
          type: "number",
          format: ".1%",
          title: "Zaposlenost muškaraca, javna služba",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog muškog stanovništva koje radi u javnoj službi, vojsci ili ima slobodno zanimanje (npr. advokati ili lekari).",
        },

        t_employed_public_service_women_perc: {
          label: "Zaposlenost žena, javna služba (u %)",
          type: "number",
          format: ".1%",
          title: "Zaposlenost žena, javna služba",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog ženskog stanovništva koje radi u javnoj službi, vojsci ili ima slobodno zanimanje (npr. advokati ili lekari).",
        },

         t_employed_other_perc: {
          label: "Ukupna zaposlenost, dr. zanimanja (u %)",
          type: "number",
          format: ".1%",
          title: "Total employment, dr. zanimanja",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog stanovništva koje bavi nenavedenim zanimanjima ili je nezaposleno.",
        },

        t_employed_other_men_perc: {
          label: "Zaposlenost muškaraca, dr. zanimanja (u %)",
          type: "number",
          format: ".1%",
          title: "Zaposlenost muškaraca, dr. zanimanja",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog muškog stanovništva koje bavi nenavedenim zanimanjima ili je nezaposleno.",
        },

        t_employed_other_women_perc: {
          label: "Zaposlenost žena, dr. zanimanja (u %)",
          type: "number",
          format: ".1%",
          title: "Zaposlenost žena, dr. zanimanja",
          latestyear: "1931",
          url: "https://milosp.info/documents/yug_census1931_v1-0-0.zip",
          source: "Preuzmite podatke",
          description: "Procenat aktivnog ženskog stanovništva koje bavi nenavedenim zanimanjima ili je nezaposleno.",
        },

      };

      // spinner loader settings
      const opts = {
        lines: 9, // The number of lines to draw
        length: 9, // The length of each line
        width: 5, // The line thickness
        radius: 14, // The radius of the inner circle
        color: "#c10e19", // #rgb or #rrggbb or array of colors
        speed: 1.9, // Rounds per second
        trail: 40, // Afterglow percentage
        className: "spinner", // The CSS class to assign to the spinner
      };

      // create spinner
      let target = d3.select("body").node();

      // trigger loader
      let spinner = new Spinner(opts).spin(target);

      // create tooltip
      let tooltip = d3
        .select("body")
        .append("div")
        .style("position", "absolute")
        .style("z-index", "10")
        .style("visibility", "hidden")
        .attr("class", "tooltip");

      // select element
      let measureSelect = d3.select("#dimensions");
      let width = 1400;
      let height = 720;

      let projection = d3
        .geoMercator()
        .scale(4800)
        .center([17.86, 44.00667])
        .translate([width / 2, height / 2]);

      let path = d3.geoPath().projection(projection);

      // use Susie Lu's d3-legend plugin
      // http://d3-legend.susielu.com/
      let d3legend = d3
        .legendColor()
        .shapeWidth(width / 25)
        .cells(9)
        .orient("horizontal")
        .labelOffset(3)
        .ascending(false)
        .labelAlign("middle")
        .shapePadding(1);

      let svg = d3.select("svg").attr("width", width).attr("height", height);

      // create options for select element
      var selectEnter = measureSelect
        .selectAll("option")
        .data(d3.keys(cols).sort())
        .enter();

      var selectUpdate = selectEnter.append("option");

      selectUpdate
        .attr("value", function (d) {
          return d;
        })
        .text(function (d) {
          return cols[d].title;
        })
        .attr("selected", function (d) {
          if (d == measure) {
            return true;
          }
        });

      let countyObj = {};

      function createMap(error, topo, census) {
        if (error) throw error;
        // stop spin.js loader
        spinner.stop();
        topo.objects.shs_srb.geometries.forEach(function (d) {
          countyObj[d.properties.id] = d;
          let value = census[d.properties.id];
          if (value) {
            let illiteracyValue = value.illiteracy;
            d.properties.illiteracy = parseFloat(illiteracyValue); //call illiteracy data
            let illiteracy11_19Value = value.illiteracy11_19;
            d.properties.illiteracy11_19 = parseFloat(illiteracy11_19Value); //call illiteracy data
            let illiteracy20_39Value = value.illiteracy20_39;
            d.properties.illiteracy20_39 = parseFloat(illiteracy20_39Value); //call illiteracy data
            let illiteracy40_59Value = value.illiteracy40_59;
            d.properties.illiteracy40_59 = parseFloat(illiteracy40_59Value);
            let illiteracy_60Value = value.illiteracy_60;
            d.properties.illiteracy_60 = parseFloat(illiteracy_60Value);
            let filliteracyValue = value.illiteracy_f;
            d.properties.illiteracy_f = parseFloat(filliteracyValue); //call female illiteracy data
            let milliteracyValue = value.illiteracy_m;
            d.properties.illiteracy_m = parseFloat(milliteracyValue); //call male illiteracy data
            let illiteracy_f_11_19Value = value.illiteracy_f_11_19;
            d.properties.illiteracy_f_11_19 = parseFloat(
              illiteracy_f_11_19Value
            ); //call female illiteracy data
            let illiteracy_m_11_19Value = value.illiteracy_m_11_19;
            d.properties.illiteracy_m_11_19 = parseFloat(
              illiteracy_m_11_19Value
            ); //call female illiteracy data
            let illiteracy_f_21_39Value = value.illiteracy_f_21_39;
            d.properties.illiteracy_f_21_39 = parseFloat(
              illiteracy_f_21_39Value
            ); //call female illiteracy data
            let illiteracy_m_21_39Value = value.illiteracy_m_21_39;
            d.properties.illiteracy_m_21_39 = parseFloat(
              illiteracy_m_21_39Value
            ); //call female illiteracy data
            let illiteracy_f_40_59Value = value.illiteracy_f_40_59;
            d.properties.illiteracy_f_40_59 = parseFloat(
              illiteracy_f_40_59Value
            ); //call female illiteracy data
            let illiteracy_m_40_59Value = value.illiteracy_m_40_59;
            d.properties.illiteracy_m_40_59 = parseFloat(
              illiteracy_m_40_59Value
            ); //call female illiteracy data
            let illiteracy_f_60Value = value.illiteracy_f_60;
            d.properties.illiteracy_f_60 = parseFloat(illiteracy_f_60Value); //call female illiteracy data
            let illiteracy_m_60Value = value.illiteracy_m_60;
            d.properties.illiteracy_m_60 = parseFloat(illiteracy_m_60Value); //call female illiteracy data
            let orthodoxValue = value.orthodox; // call orthodox data
            d.properties.orthodox = parseFloat(orthodoxValue);
            let protestantValue = value.protestant; // call protestant data
            d.properties.protestant = parseFloat(protestantValue);
            let rcatholicValue = value.rcatholic; // call catholic data
            d.properties.rcatholic = parseFloat(rcatholicValue);
            let muslimValue = value.muslim; // call muslim data
            d.properties.muslim = parseFloat(muslimValue);
            let otherrelValue = value.otherrel; // call other data
            d.properties.otherrel = parseFloat(otherrelValue);
            let s_lang_srb_cro_svnValue = value.s_lang_srb_cro_svn; // call other data
            d.properties.s_lang_srb_cro_svn = parseFloat(s_lang_srb_cro_svnValue);
            let s_lang_othr_slavicValue = value.s_lang_othr_slavic; // call other data
            d.properties.s_lang_othr_slavic = parseFloat(s_lang_othr_slavicValue);
            let s_lang_hungarianValue = value.s_lang_hungarian; // call other data
            d.properties.s_lang_hungarian = parseFloat(s_lang_hungarianValue);
            let s_lang_germanValue = value.s_lang_german; // call other data
            d.properties.s_lang_german = parseFloat(s_lang_germanValue);
            let s_lang_albanianValue = value.s_lang_albanian; // call other data
            d.properties.s_lang_albanian = parseFloat(s_lang_albanianValue);
            let s_lang_otherValue = value.s_lang_other; // call other data
            d.properties.s_lang_other = parseFloat(s_lang_otherValue);
            let t_employed_agriculture_percValue = value.t_employed_agriculture_perc; // call other data
            d.properties.t_employed_agriculture_perc = parseFloat(t_employed_agriculture_percValue);
            let t_employed_agriculture_men_percValue = value.t_employed_agriculture_men_perc; // call other data
            d.properties.t_employed_agriculture_men_perc = parseFloat(t_employed_agriculture_men_percValue);
            let t_employed_agriculture_women_percValue = value.t_employed_agriculture_women_perc; // call other data
            d.properties.t_employed_agriculture_women_perc = parseFloat(t_employed_agriculture_women_percValue);
            let t_employed_industry_percValue = value.t_employed_industry_perc; // call other data
            d.properties.t_employed_industry_perc = parseFloat(t_employed_industry_percValue);
            let t_employed_industry_men_percValue = value.t_employed_industry_men_perc; // call other data
            d.properties.t_employed_industry_men_perc = parseFloat(t_employed_industry_men_percValue);
            let t_employed_industry_women_percValue = value.t_employed_industry_women_perc; // call other data
            d.properties.t_employed_industry_women_perc = parseFloat(t_employed_industry_women_percValue);
            let t_employed_commerce_percValue = value.t_employed_commerce_perc; // call other data
            d.properties.t_employed_commerce_perc = parseFloat(t_employed_commerce_percValue);
            let t_employed_commerce_men_percValue = value.t_employed_commerce_men_perc; // call other data
            d.properties.t_employed_commerce_men_perc = parseFloat(t_employed_commerce_men_percValue);
            let t_employed_commerce_women_percValue = value.t_employed_industry_women_perc; // call other data
            d.properties.t_employed_commerce_women_perc = parseFloat(t_employed_commerce_women_percValue);
            let t_employed_public_service_percValue = value.t_employed_public_service_perc; // call other data
            d.properties.t_employed_public_service_perc = parseFloat(t_employed_public_service_percValue);
            let t_employed_public_service_men_percValue = value.t_employed_public_service_men_perc; // call other data
            d.properties.t_employed_public_service_men_perc = parseFloat(t_employed_public_service_men_percValue);
            let t_employed_public_service_women_percValue = value.t_employed_industry_women_perc; // call other data
            d.properties.t_employed_public_service_women_perc = parseFloat(t_employed_public_service_women_percValue);
            let t_employed_other_percValue = value.t_employed_other_perc; // call other data
            d.properties.t_employed_other_perc = parseFloat(t_employed_other_percValue);
            let t_employed_other_men_percValue = value.t_employed_other_men_perc; // call other data
            d.properties.t_employed_other_men_perc = parseFloat(t_employed_other_men_percValue);
            let t_employed_other_women_percValue = value.t_employed_other_women_perc; // call other data
            d.properties.t_employed_other_women_perc = parseFloat(t_employed_other_women_percValue);
          }
        });

        let centered;

        // render map colors based on data
        function renderMap() {
          var color = d3
            .scaleThreshold()
            .domain([0, 5, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100])
            .range([
              "#f9d1d1",
              "#f3b4c6",
              "#e998be",
              "#da7db7",
              "#c863b3",
              "#9f59aa",
              "#7c4c9d",
              "#5d3e8d",
              "#41307b",
              "#272168",
              "#0b1354",
            ]);

          d3legend
            .title(cols[measure].label)
            .labels([
              "0-5",
              "6-10",
              "11-20",
              "21-30",
              "31-40",
              "41-50",
              "51-60",
              "61-70",
              "71-80",
              "81-90",
              ">90",
            ])
            .scale(color);

          // if legend already exists, remove and create again
          svg.select(".legend").remove();

          // create legend
          let legend = svg
            .append("g")
            .attr("class", "legend")
            .attr(
              "transform",
              "translate(" + width / 24 + "," + (height * 6) / 7 + ")"
            )
            .style("font-size", 18)
            .style("font-weight", 800);

          svg
            .select(".legend")
            .append("rect")
            .attr("width", "50%")
            .attr("height", "10%")
            .attr("fill", "rgba(255, 255, 255, 0.5)");

          legend.call(d3legend);

          countyPath
            .transition()
            .duration(800)
            .style("fill", function (d) {
              let county = countyObj[d.properties.id];
              if (county && county.properties[measure] === null) {
                return "#ccc";
              } else if (county) {
                return color(county.properties[measure]);
              } else {
                return "#ccc";
              }
            })
            .attr("county", function (d) {
              return d.properties.srez;
            });
        }

        // define zoom function
        function zoomed() {
          group.attr("transform", d3.event.transform);
        }

        // When clicked, zoom in
        function clicked(d) {
          var x, y, k;

          // Compute centroid of the selected path
          if (d && centered !== d) {
            // if (d) {
            var centroid = path.centroid(d);
            x = centroid[0];
            y = centroid[1];
            // k = zoom.scaleExtent()[1];
            k = 10;
            centered = d;
          } else {
            x = width / 2;
            y = height / 2;
            k = 1;
            centered = null;
          }

          // Manually Zoom
          svg
            .transition()
            .duration(750)
            .call(
              zoom.transform,
              d3.zoomIdentity
                .translate(width / 2, height / 2)
                .scale(k)
                .translate(-x, -y)
            );
        }

        // create background box for zoom
        svg
          .append("rect")
          .attr("class", "background")
          .attr("width", width)
          .attr("height", height);

        let zoom = d3.zoom().scaleExtent([1, 12]).on("zoom", zoomed);

        svg.style("pointer-events", "all").call(zoom);

        let group = svg.append("g").attr("class", "continent");

        let countyPath = group
          .selectAll(".counties")
          .data(topojson.feature(topo, topo.objects.shs_srb).features)
          .enter()
          .append("path")
          .attr("class", "county-border")
          .on("click", clicked)
          .attr("d", path);
        renderMap();
        renderText();
        bindHover();
        setResponsiveSVG();

        measureSelect.on("change", function (d) {
          measure = this.value;
          renderMap();
          renderText();
        });
      }

      // change factor description
      function renderText() {
        let textHeader = d3.select("#textDescription h3");
        let textDescription = d3.select("#textDescription p");
        let textFootnote = d3.select("#source");

        let title = cols[measure].title;
        let description = cols[measure].description;
        let url = cols[measure].url;
        let source = cols[measure].source;

        textHeader
          .style("opacity", 0)
          .transition()
          .duration(1000)
          .style("opacity", 1)
          .text(title);
        textDescription
          .style("opacity", 0)
          .transition()
          .duration(1000)
          .style("opacity", 1)
          .text(description);
        textFootnote.html(
          `<h3>Podaci</h3>
          <div><a href=${url} target="_blank" rel="noopener">${source}</a></div>
          `
        );
      }

      // define mouseover and mouseout events

      function bindHover() {
        document.body.addEventListener("mousemove", function (e) {
          if (e.target.nodeName == "path") {
            let d = d3.select(e.target).data()[0].properties;
            let value = countyObj[d.id].properties[measure];
            let content = "";

            if (value === null) {
              content = `<div>${d.srez} <br> ${d.banovina}</div><hr><div>Bez podataka</div>`;
            } else {
              content = `<div>${d.srez} <br> ${d.banovina}<hr></div>
                <div>${cols[measure].title}: ${value.toFixed(
                1
              )}%</div><hr><div><small>Kliknite na srez/grad da uvećate prikaz.<br>Ponovo kliknite da smanjite prikaz.<br>Uveličajte ili smanjite prikaz točkićem od miša.</div>`;
            }

            showDetail(e, content);
          }
        });

        document.body.addEventListener("mouseout", function (e) {
          if (e.target.nodeName == "path") hideDetail();
        });
      }

      // Show tooltip on hover
      function showDetail(event, content) {
        // show tooltip with information from the __dat__ property of the element
        let x_hover = 0;
        let y_hover = 0;

        let tooltipWidth = parseInt(tooltip.style("width"));
        let tooltipHeight = parseInt(tooltip.style("height"));
        let classed, notClassed;

        if (event.pageX > document.body.clientWidth / 2) {
          x_hover = tooltipWidth + 10;
          classed = "right";
          notClassed = "left";
        } else {
          x_hover = -30;
          classed = "left";
          notClassed = "right";
        }

        y_hover =
          document.body.clientHeight - event.pageY < tooltipHeight + 4
            ? event.pageY - (tooltipHeight + 2)
            : event.pageY - tooltipHeight / 2;

        return tooltip
          .classed(classed, true)
          .classed(notClassed, false)
          .style("visibility", "visible")
          .style("top", y_hover + "px")
          .style("left", event.pageX - x_hover + "px")
          .html(content);
      }

      // Hide tooltip on hover
      function hideDetail() {
        // hide tooltip
        return tooltip.style("visibility", "hidden");
      }

      // Many browsers -- IE particularly -- will not auto-size inline SVG
      // IE applies default width and height sizing
      // padding-bottom hack on a container solves IE inconsistencies in size
      // https://css-tricks.com/scale-svg/#article-header-id-10
      function setResponsiveSVG() {
        let width = +d3.select("svg").attr("width");
        let height = +d3.select("svg").attr("height");
        let calcString = +(height / width) * 100 + "%";

        let svgElement = d3.select("svg");
        let svgParent = d3.select(d3.select("svg").node().parentNode);

        svgElement
          .attr("class", "scaling-svg")
          .attr("preserveAspectRatio", "xMinYMin")
          .attr("viewBox", "0 0 " + width + " " + height)
          .attr("width", null)
          .attr("height", null);

        svgParent.style("padding-bottom", calcString);
      }

      let global_data = countyObj;
      d3.json("info_srb.json", function (global_data) {
        // generate a list of counties for auto complete
        ////////////////////////////////////////////////
        // get all counties

        all_counties = [];
        // loop through countyObj
        for (i = 0; i < global_data.length; i++) {
          all_counties.push(global_data[i]["srez"]);
        }

        // use Jquery autocomplete
        ////////////////////////////////
        $("#county_search_box").autocomplete({
          source: all_counties,
          select: function (event, ui) {
            var value = ui.item.value;
            find_county(value);
          },
        });

        $("#county_search_box").keyup(function (e) {
          if (e.keyCode == 13) {
            find_county();
          }
        });
      });

      // find county in data
      function find_county(county) {
        if (!county) {
          county = $("#county_search_box").val();
        }

        if (all_counties.includes(county)) {
          // zoom and highlight identified county
          highlight_searched(county);
        }
      }

      // zoom into and highlight the found the county
      function highlight_searched(county) {
        let currentlyHighlighted = $(".highlightedPath")[0];

        if (currentlyHighlighted) {
          currentlyHighlighted.classList.remove("highlightedPath");
        }

        let element = $(`[county='${county}']`)[0];

        element.classList.add("highlightedPath");
      }

      // load data
      d3.queue()
        .defer(d3.json, "shs_srb.json")
        .defer(d3.csv, "census1931.csv")
        .await(createMap);
    </script>
  </body>
</html>
